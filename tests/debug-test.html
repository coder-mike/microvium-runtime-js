<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div id="mocha"></div>
  <script type="module">
    import Runtime, { useWasmModule } from '../dist/index.mjs';

    const assert = p => { if (!p) { throw new Error('Assertion failed'); } }
    assert.equal = (a, b) => { if (a !== b) { throw new Error(`Assertion failed: ${a} !== ${b}`); } }

    useWasmModule(WebAssembly.compileStreaming(fetch("../build/microvium1.wasm")));

    // 1. Paste the snapshot here (e.g. from build/dbg-passing-functions-bytes.js):
    const snapshot = [0x7,0x1c,0x7,0x0,0x54,0x1,0x8b,0x47,0x3,0x0,0x0,0x0,0x1c,0x0,0x1c,0x0,0x48,0x0,0x48,0x0,0x4e,0x0,0x54,0x0,0x28,0x1,0x36,0x1,0x1,0x0,0xa1,0x0,0x2,0x0,0xd5,0x0,0x3,0x0,0xdd,0x0,0x4,0x0,0xe5,0x0,0x5,0x0,0xed,0x0,0x6,0x0,0xf5,0x0,0x7,0x0,0xfd,0x0,0x8,0x0,0x5,0x1,0x9,0x0,0xd,0x1,0xa,0x0,0x19,0x1,0xc,0x0,0x25,0x1,0x35,0x1,0x31,0x1,0x1,0x0,0x59,0x0,0x79,0x0,0x69,0x0,0x0,0x0,0xe,0x40,0x6e,0x65,0x77,0x55,0x69,0x6e,0x74,0x38,0x41,0x72,0x72,0x61,0x79,0x0,0xb,0x40,0x74,0x79,0x70,0x65,0x43,0x6f,0x64,0x65,0x4f,0x66,0x0,0x0,0x0,0x0,0x5,0x40,0x70,0x75,0x73,0x68,0x0,0x0,0x5,0x50,0x1,0x31,0x7d,0x3,0x60,0x0,0x5,0x50,0x1,0x31,0x7d,0x5,0x60,0x0,0xd,0x50,0x4,0x31,0x30,0x30,0x88,0x1d,0x0,0x6b,0x12,0x6f,0x67,0x1,0x60,0x0,0x2f,0x50,0x4,0x89,0x0,0x0,0x10,0x88,0x59,0x0,0x6b,0x11,0x9,0x78,0x2,0xa0,0x10,0x8c,0x2,0x0,0x67,0xa,0x89,0x2,0x0,0x6,0x12,0x6f,0x67,0xb,0x89,0x2,0x0,0x7,0x12,0x6f,0x67,0x88,0x1b,0x0,0x89,0x2,0x0,0x8,0x12,0x6f,0x67,0x1,0x60,0x0,0x0,0x0,0x5,0x50,0x1,0x89,0x1,0x0,0x60,0x0,0x5,0x50,0x1,0x89,0x2,0x0,0x60,0x0,0x5,0x50,0x2,0x31,0x6,0x6b,0x60,0x0,0x5,0x50,0x2,0x31,0x7,0x6b,0x60,0x0,0x5,0x50,0x2,0x31,0x8,0x6b,0x60,0x0,0x5,0x50,0x2,0x31,0x9,0x6b,0x60,0x0,0x5,0x50,0x2,0x31,0x32,0x6b,0x60,0x0,0x7,0x50,0x4,0x33,0x31,0x32,0x12,0x6f,0x60,0x0,0x0,0x0,0x7,0x50,0x4,0x32,0x31,0x6,0x12,0x6f,0x60,0x0,0x0,0x0,0x3,0x50,0x1,0x31,0x60,0x0,0x2,0x0,0x1a,0x0,0x1,0x0,0x19,0x0,0x10,0x0,0x19,0x0,0x1,0x0,0xc,0xc0,0x5,0x0,0x5,0x0,0x59,0x0,0x81,0x0,0x69,0x0,0x89,0x0,0x8,0xc0,0x5,0x0,0x5,0x0,0x79,0x0,0x91,0x0,0x3,0x70,0x1,0x2,0x3,0x0];

    // 3. Paste the test code here:
    // --------------------------------- BEGIN --------------------------------
    const vm = await Runtime.restore(snapshot, { });
    const { [1]: init, [2]: getRomArr, [3]: getRamArr, [4]: get0, [5]: get1, [6]: get2, [7]: get3, [8]: get, [9]: set, [10]: set0, [12]: identity } = vm.exports;

    const romArr_ = getRomArr();
    assert(romArr_.length === 3);
    const romArr = romArr_.slice();
    assert(romArr instanceof Uint8Array);
    assert.equal(get0(romArr_), 1);
    assert.equal(get1(romArr_), 2);
    assert.equal(get2(romArr_), 3);
    assert.equal(get3(romArr_), undefined);
    assert.equal(get(romArr_, 0), 1);
    assert.equal(get(romArr_, 1), 2);
    assert.equal(get(romArr_, 2), 3);
    assert.equal(get(romArr_, 3), undefined);

    // ---------------------------------- END ---------------------------------

    // 3. Run `npx serve` in the root project folder, open
    //    http://localhost:3000/tests/debug-test.html in Chrome and debug in
    //    devtools.
  </script>
</body>
</html>